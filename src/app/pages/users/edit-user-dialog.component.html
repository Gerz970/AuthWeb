<div class="edit-user-dialog">
  <h2 mat-dialog-title class="text-xl font-bold text-gray-800">
    Editar Usuario
  </h2>

  <mat-dialog-content class="py-4">
    <!-- User Avatar -->
    <div class="flex justify-center mb-6">
      <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl font-bold">
        {{ getInitials(data.user.fullName) }}
      </div>
    </div>

    <form [formGroup]="form" class="space-y-4">
      <!-- ID (readonly) -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>ID del Usuario</mat-label>
        <input matInput formControlName="id" readonly>
        <mat-icon matPrefix>fingerprint</mat-icon>
      </mat-form-field>

      <!-- Full Name -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Nombre Completo</mat-label>
        <input matInput formControlName="fullName" placeholder="Nombre completo">
        <mat-icon matPrefix>person</mat-icon>
        <mat-error *ngIf="form.get('fullName')?.hasError('required')">
          El nombre es requerido
        </mat-error>
      </mat-form-field>

      <!-- Email -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" placeholder="Email" type="email">
        <mat-icon matPrefix>email</mat-icon>
        <mat-error *ngIf="form.get('email')?.hasError('required')">
          El email es requerido
        </mat-error>
        <mat-error *ngIf="form.get('email')?.hasError('email')">
          Ingrese un email válido
        </mat-error>
      </mat-form-field>

      <!-- Phone Number -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Teléfono</mat-label>
        <input matInput formControlName="phoneNumber" placeholder="Teléfono (opcional)">
        <mat-icon matPrefix>phone</mat-icon>
      </mat-form-field>

      <!-- Roles -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Roles</mat-label>
        <mat-select formControlName="roles" multiple [disabled]="isLoadingRoles">
          @if (isLoadingRoles) {
            <mat-option disabled>
              <mat-spinner diameter="20"></mat-spinner>
              Cargando roles...
            </mat-option>
          } @else {
            @for (role of availableRoles; track role.id) {
              <mat-option [value]="role.name">
                {{ role.name }} ({{ role.totalUsers }} usuarios)
              </mat-option>
            }
          }
        </mat-select>
        <mat-icon matPrefix>security</mat-icon>
        <mat-error *ngIf="form.get('roles')?.hasError('required')">
          Al menos un rol es requerido
        </mat-error>
      </mat-form-field>

      <!-- Current Roles Display -->
      @if (data.user.roles.length > 0) {
        <div class="mt-2">
          <label class="text-sm font-medium text-gray-700">Roles Actuales:</label>
          <div class="flex flex-wrap gap-2 mt-1">
            @for (role of data.user.roles; track role) {
              <mat-chip 
                [color]="role === 'Admin' ? 'warn' : 'primary'" 
                class="text-xs">
                {{ role }}
              </mat-chip>
            }
          </div>
        </div>
      }
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="gap-2">
    <button mat-button (click)="onCancel()" [disabled]="isSubmitting">
      Cancelar
    </button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()" 
      [disabled]="!form.valid || isSubmitting">
      @if (isSubmitting) {
        <mat-spinner diameter="20" class="mr-2"></mat-spinner>
        Actualizando...
      } @else {
        Actualizar Usuario
      }
    </button>
  </mat-dialog-actions>
</div> 